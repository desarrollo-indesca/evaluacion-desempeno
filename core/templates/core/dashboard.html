{% extends 'base.html' %}

{% block head %}
<style>
    .card {
        margin: 1rem auto;
        max-width: 400px;
    }
    .card.bg-green {
        background-color: #34D399;
    }
    .card.bg-yellow {
        background-color: #F7DC6F;
    }
    .card.bg-red {
        background-color: #FF6C6C;
    }
</style>
{% endblock %}

{% block content %}
<div role="tablist" class="tabs tabs-lifted">
    <input type="radio" name="my_tabs_2" role="tab" class="tab" aria-label="Inicio" checked />
    <div role="tabpanel" class="tab-content bg-base-100 border-base-300 rounded-box p-6">
        <h1 class="text-3xl text-center font-semibold">Evaluación de Desempeño del Personal</h1>

        <div class="grid grid-cols-12">
            <div class="md:col-span-3 xs:col-span-12">
                <div class="card border-2 border my-4">
                    <div class="card-content p-4">
                        <h2 class="text-2xl font-semibold text-center">Información del Usuario</h2>
                        <hr>
                        <div class="overflow-x-auto">
                            <table class="table w-full">
                                <tbody>
                                    <tr>
                                        <th>Ficha</th>
                                        <td>{{datos_personal.ficha}}</td>
                                    </tr>
                                    <tr>
                                        <th>Nombre</th>
                                        <td>{{request.user.get_full_name}}</td>
                                    </tr>
                                    <tr>
                                        <th>Tipo de Personal</th>
                                        <td>{{datos_personal.tipo_personal}}</td>
                                    </tr>
                                    <tr>
                                        <th>Cargo</th>
                                        <td>{{datos_personal.cargo}}</td>
                                    </tr>
                                    <tr>
                                        <th>Supervisor</th>
                                        <td>{% if datos_personal.supervisor %}{{datos_personal.supervisor}}{% else %}No tiene{% endif %}</td>
                                    </tr>
                                    <tr>
                                        <th>Gerencia</th>
                                        <td>{{datos_personal.gerencia}}</td>
                                    </tr>
                                    <tr>
                                        <th>Fecha de Ingreso</th>
                                        <td>{{datos_personal.fecha_ingreso}}</td>
                                    </tr>
                                    <tr>
                                        <th>Antigüedad</th>
                                        <td>{{antiguedad}} meses</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="md:col-span-9 xs:col-span-12">
                <div class="grid grid-cols-12">
                    <div class="md:col-span-12 xs:col-span-12">
                        <div class="card border-2 border my-4 mx-2 w-full" id="proceso-evaluacion" style="min-width: 100%;">
                            <h2 class="text-center text-2xl font-semibold">Proceso de Evaluación</h2>
                            <hr><br>
                            <ul class="steps steps-horizontal w-full">
                                <li class="step {% if evaluacion.estado != 'P' %}step-error{% endif %}">Autoevaluación</li>
                                <li class="step {% if evaluacion.estado != 'P' and evaluacion.estado != 'E' %}step-error{% endif %}">Revisión por Supervisor</li>
                                <li class="step {%  if evaluacion.estado == 'G' or evaluacion.estado == 'H' or evaluacion.estado == 'A' %}step-error{% endif %}">Revisión por Gerencia</li>
                                <li class="step {% if evaluacion.estado == 'H' or evaluacion.estado == 'A' %}step-error{% endif %}">Revisión por Gestión Humana</li>
                                <li class="step {% if evaluacion.estado == 'A' %}step-error{% endif %}">Aprobada</li>
                            </ul>

                            {% if evaluacion.estado != 'P' and evaluacion.estado != 'E' %}
                            <table class="table w-full">
                                <tbody>
                                    <tr>
                                        <th>Periodo</th>
                                        <td class="text-center">{{periodo.fecha_inicio}} - {{periodo.fecha_fin}}</td>
                                    </tr>
                                    <tr>
                                        <th>Fecha de Inicio</th>
                                        <td class="text-center">{{evaluacion.fecha_inicio|default:'-'}}</td>
                                    </tr>
                                    <tr>
                                        <th>Fecha Envío a Supervisor</th>
                                        <td class="text-center">{{evaluacion.fecha_fin|default:'-'}}</td>
                                    </tr>
                                    <tr>
                                        <th>Fecha Revisión por Supervisor</th>
                                        <td class="text-center">{{evaluacion.fecha_revision|default:'-'}}</td>
                                    </tr>
                                    <tr>
                                        <th>Fecha Envío a Gestión Humana</th>
                                        <td class="text-center">{{evaluacion.fecha_envio|default:'-'}}</td>
                                    </tr>
                                    <tr>
                                        <th>Fecha Aprobación</th>
                                        <td class="text-center">{{evaluacion.fecha_aprobacion|default:'-'}}</td>
                                    </tr>
                                    <tr>
                                        <td colspan="2" class="text-center">
                                            <a class="btn btn-error" href="#">Ver Evaluación</a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            {% elif evaluacion.estado == 'P' %}
                            <div class="w-full flex justify-center items-center p-4">
                                <form method="post" hx-post="{% url 'comenzar_evaluacion' pk=evaluacion.pk %}" hx-select="#proceso-evaluacion" hx-target="#proceso-evaluacion" hx-swap="outerHTML">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-error" id="btn_comenzar">Comenzar Evaluación</button>
                                </form>
                            </div>
                            {% else %}
                            <table class="table w-full text-center">
                                <thead>
                                    <tr>
                                        <th>Instrumento</th>
                                        <th>Estado</th>
                                        <th>Total</th>
                                        <th>Editar</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for instrumento in evaluacion.formulario.instrumentos.all %}
                                    <tr>
                                        <td>{{instrumento}}</td>
                                        <td>{{instrumento.estado}}</td>
                                        <td><a class="btn btn-error" href="#">Acceder al Instrumento</a></td>
                                    </tr>
                                    {% endfor %}
                                    <tr>
                                        <td>Formación</td>
                                        <td></td>
                                        <td>
                                            <a class="btn btn-error" href="#">Acceder al Instrumento</a>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Logros y Metas</td>
                                        <td></td>
                                        <td>
                                            <a class="btn btn-error" href="#">Acceder al Instrumento</a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
  
    <input type="radio" name="my_tabs_2" role="tab" class="tab" aria-label="Consultar" />
    <div role="tabpanel" class="tab-content bg-base-100 border-base-300 rounded-box p-6">
      Tab content 2
    </div>
  
    <input type="radio" name="my_tabs_2" role="tab" class="tab" aria-label="Revisar" />
    <div role="tabpanel" class="tab-content bg-base-100 border-base-300 rounded-box p-6">
      Tab content 3
    </div>
  </div>
{% endblock %}