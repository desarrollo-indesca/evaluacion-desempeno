{%  load widget_tweaks %}

<h3 class="text-center text-2xl">Consulta de Supervisados (Periodo Actual)</h3>
<hr>

<form hx-get="{% url 'consultar_supervisados' pk=request.user.pk %}" hx-select="#supervisados" hx-target="#supervisados" hx-swap="outerHTML" hx- hx-trigger="change" id="filter-form" class="flex justify-evenly w-full">
    <div>
        {{filter.form.ficha.label_tag}} <br>
        {% render_field filter.form.ficha class="input input-bordered w-full" %}
    </div>
    <div>
        {{filter.form.user__first_name.label_tag}} <br>
        {% render_field filter.form.user__first_name class="input input-bordered w-full" %}
    </div>
</form>

<table class="table table-zebra my-4 text-center">
    <thead class="bg-gray-900 text-white">
        <tr>
            <th>Ficha</th>
            <th>Nombre</th>
            <th>Evaluación Actual</th>
            <th>Acciones</th>
        </tr>
    </thead>

    <tbody id="supervisados">
        {% for supervisado in filter.qs %}
        <tr>
            <td>{{supervisado.ficha}}</td>
            <td>{{supervisado.user.get_full_name.upper}}</td>
            {% with evaluacion=supervisado.evaluacion_actual %}
            <td>
                {% if evaluacion %}
                {{evaluacion.estado_largo}}
                {% else %}
                <span class="badge badge-error">Sin Evaluación Activa</span>
                {% endif %}
            </td>
            <td>
                {% if evaluacion %}
                {% if evaluacion.estado == 'S' %}
                <a for="modal-{{evaluacion.pk}}" class="btn btn-error" href="#" hx-get="{% url 'revisar_evaluacion' pk=evaluacion.pk %}" hx-target="closest .tab-content">Revisar Evaluación Actual</a>
                {% else %}
                <label for="modal-{{evaluacion.pk}}" class="btn btn-error">Revisar Evaluación Actual</label>
                {% include 'evaluacion/partials/modal-evaluacion-empleado.html' with evaluacion=evaluacion include_others=True finish=False id=evaluacion.pk %}
                {% endif %}
                {% endif %}
                
                <a class="btn btn-gray" hx-target="closest .tab-content" hx-get="{% url 'consultar_historico_supervisados' pk=supervisado.pk %}">Ver Histórico de Evaluaciones</a>
            </td>
            {% endwith %}
        </tr>
        {% empty %}
        <tr>
            <th colspan="4">Usted no tiene supervisados.</th>
        </tr>
        {% endfor %}
    </tbody>
</table>